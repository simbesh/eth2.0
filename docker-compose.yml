version: "3"
services:
  eth-node:
    image: ethereum/client-go:stable
    volumes:
      - eth-data:/data
    ports:
      - 30303:30303/tcp
      - 30304:30304/udp
      - 8545:8545
    command:
      - --goerli
      - --http
      - --http.addr=0.0.0.0
      - --http.vhosts=*
      - --http.corsdomain=*
      - --allow-insecure-unlock
      - --metrics
      - --metrics.expensive
      - --pprof
      - --pprof.addr=0.0.0.0
      - --datadir=/data
    networks:
      - core

  beacon-node:
    image: gcr.io/prysmaticlabs/prysm/beacon-chain:latest
    volumes:
      - beacon-data:/data
      - ./beacon/beacon.yaml:/config/beacon.yaml:ro
    ports:
      - 12000:12000/udp
      - 13000:13000
      - 4000:4000
      - 8080:8080
    command:
      - --config-file=/config/beacon.yaml
      - --dev
      - --block-batch-limit=512
    networks:
      - core

  validator:
    image: gcr.io/prysmaticlabs/prysm/validator:latest
    depends_on:
      - beacon-node
    volumes:
      - /home/simbesh/.prysm/validator:/wallet:ro
      - /home/simbesh/.prysm/password:/password:ro
      - validator-data:/data
    ports:
      - 8081:8081
    command:
      - --monitoring-host=0.0.0.0
      - --beacon-rpc-provider=beacon-node:4000
      - --wallet-dir=/wallet
      - --wallet-password-file=/password/validator-pw.txt
      - --datadir=/data
    networks:
      - core

  slasher:
    image: gcr.io/prysmaticlabs/prysm/slasher:latest
    depends_on:
      - beacon-node
    volumes:
      - slasher-data:/data
    ports:
      - 8082:8082
    command:
      - --monitoring-host=0.0.0.0
      - --beacon-rpc-provider=beacon-node:4000
      - --datadir=/data
    networks:
      - core

  eth2stat:
    image: alethio/eth2stats-client:latest
    depends_on:
      - beacon-node
    volumes:
      - eth2stat-data:/data
    command:
      - run
      - --eth2stats.node-name=__Bech__Prysm
      - --data.folder=/data
      - --eth2stats.addr=grpc.medalla.eth2stats.io:443
      - --eth2stats.tls=true
      - --beacon.type=prysm
      - --beacon.addr=beacon-node:4000
      - --beacon.metrics-addr=http://beacon-node:8080/metrics
    networks:
      - core

volumes:
  eth-data:
  beacon-data:
  eth2stat-data:
  validator-data:
  slasher-data:

networks:
  core:
    external: true
